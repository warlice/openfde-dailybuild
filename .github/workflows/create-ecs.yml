name: Scheduled ECS Creation

#on:
  #schedule:
    # 使用 cron 语法设置定时，此处为每天 UTC 时间 00:00 运行
    # 注意：GitHub Actions 使用 UTC 时间，请根据你的时区调整
    #- cron: '0 0 * * *'
  # 允许在 GitHub 页面上手动触发此工作流
  #workflow_dispatch:

on:
  push:
    branches: [ "master" ]

jobs:
  create-ecs:
    runs-on: ubuntu-latest
    steps:
      - name: Configure Aliyun CLI
        run: |
          # 1. 安装 Aliyun CLI
          curl -sSL https://aliyuncs.github.io/aliyun-cli/install.sh | bash
          # 2. 配置认证信息（从仓库 Secrets 读取）
          aliyun configure set \
            --profile default \
            --region ${{ secrets.ALIYUN_REGION }} \
            --access-key-id ${{ secrets.ALIYUN_ACCESS_KEY_ID }} \
            --access-key-secret ${{ secrets.ALIYUN_ACCESS_KEY_SECRET }}

      - name: Create ECS Instance
        run: |
          aliyun ecs RunInstances \
            --RegionId ${{ secrets.ALIYUN_REGION }} \
            --InstanceType ecs.g6.large \
            --ImageId ubuntu_22_04_x64_20G_alibase_20230907.vhd \
            --SecurityGroupId ${{ secrets.ALIYUN_SECURITY_GROUP_ID }} \
            --VSwitchId ${{ secrets.ALIYUN_VSWITCH_ID }} \
            --Amount 1
